<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Segredinho VIP ‚Äì Chat ‚Äì minhacoroaplus.site</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
/* Adicionando CSS completo para o chat funcionar corretamente */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  height: 100vh;
  overflow: hidden;
}

.main-container {
  height: 100vh;
  display: flex;
  flex-direction: column;
  max-width: 400px;
  margin: 0 auto;
  background: #fff;
  box-shadow: 0 0 20px rgba(0,0,0,0.1);
}

.chat-container {
  display: flex;
  flex-direction: column;
  height: 100%;
}

.chat-header {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 15px;
  display: flex;
  align-items: center;
  gap: 15px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.back-arrow {
  font-size: 20px;
  cursor: pointer;
  padding: 5px;
  border-radius: 50%;
  transition: background 0.3s;
}

.back-arrow:hover {
  background: rgba(255,255,255,0.2);
}

.profile-header {
  display: flex;
  align-items: center;
  gap: 12px;
  flex: 1;
}

.profile-header img {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  object-fit: cover;
  border: 2px solid rgba(255,255,255,0.3);
}

.profile-info {
  flex: 1;
}

.profile-name {
  font-weight: 600;
  font-size: 16px;
}

.profile-status {
  font-size: 12px;
  opacity: 0.8;
}

.chamada-vip-chat-button {
  background: rgba(255,255,255,0.2);
  border: 1px solid rgba(255,255,255,0.3);
  color: white;
  padding: 8px 12px;
  border-radius: 20px;
  font-size: 12px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 5px;
  transition: all 0.3s;
}

.chamada-vip-chat-button:hover {
  background: rgba(255,255,255,0.3);
}

.messages {
  flex: 1;
  padding: 20px;
  overflow-y: auto;
  background: #f8f9fa;
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.message {
  max-width: 80%;
  padding: 12px 16px;
  border-radius: 18px;
  word-wrap: break-word;
  animation: messageSlide 0.3s ease-out;
}

@keyframes messageSlide {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.message.bot {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  align-self: flex-start;
  border-bottom-left-radius: 4px;
}

.message.user {
  background: #e3f2fd;
  color: #1976d2;
  align-self: flex-end;
  border-bottom-right-radius: 4px;
}

.message.audio {
  background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
  color: white;
  display: flex;
  align-items: center;
  gap: 10px;
  cursor: pointer;
  transition: transform 0.2s;
}

.message.audio:hover {
  transform: scale(1.02);
}

.audio-icon {
  width: 20px;
  height: 20px;
  fill: currentColor;
}

.input-area {
  padding: 15px;
  background: white;
  border-top: 1px solid #e0e0e0;
  display: flex;
  gap: 10px;
  align-items: center;
}

#userInput {
  flex: 1;
  padding: 12px 16px;
  border: 1px solid #e0e0e0;
  border-radius: 25px;
  outline: none;
  font-size: 14px;
  transition: border-color 0.3s;
}

#userInput:focus {
  border-color: #667eea;
}

#userInput:disabled {
  background: #f5f5f5;
  cursor: not-allowed;
}

.mic-button, #sendButton {
  width: 45px;
  height: 45px;
  border: none;
  border-radius: 50%;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s;
}

.mic-button:hover, #sendButton:hover {
  transform: scale(1.05);
  box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
}

.mic-button:disabled, #sendButton:disabled {
  background: #ccc;
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}

/* Popup styles */
.popup-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.popup {
  background: white;
  padding: 30px;
  border-radius: 15px;
  text-align: center;
  max-width: 350px;
  margin: 20px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.3);
}

.popup h3 {
  color: #333;
  margin-bottom: 15px;
  font-size: 20px;
}

.popup p {
  color: #666;
  margin-bottom: 20px;
  line-height: 1.5;
}

.popup-buttons {
  display: flex;
  gap: 10px;
  justify-content: center;
}

.popup-button {
  padding: 12px 24px;
  border: none;
  border-radius: 25px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s;
}

.popup-button.primary {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
}

.popup-button.secondary {
  background: #f0f0f0;
  color: #333;
}

.popup-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(0,0,0,0.2);
}

.saldo-info {
  background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
  color: white;
  padding: 10px 15px;
  border-radius: 10px;
  margin: 10px 0;
  text-align: center;
  font-weight: 600;
}

.blocked-message {
  background: #ffebee;
  color: #c62828;
  padding: 10px;
  border-radius: 8px;
  text-align: center;
  font-size: 12px;
  margin-top: 5px;
}

/* Video call styles */
.video-call-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: #000;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 2000;
}

.video-call-content {
  text-align: center;
  color: white;
}

.video-call-avatar {
  width: 120px;
  height: 120px;
  border-radius: 50%;
  margin-bottom: 20px;
  border: 4px solid #667eea;
}

.video-call-name {
  font-size: 24px;
  margin-bottom: 10px;
}

.video-call-status {
  font-size: 16px;
  opacity: 0.8;
  margin-bottom: 40px;
}

.video-call-controls {
  display: flex;
  gap: 20px;
}

.video-call-button {
  width: 60px;
  height: 60px;
  border: none;
  border-radius: 50%;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s;
}

.video-call-button.accept {
  background: #4CAF50;
}

.video-call-button.decline {
  background: #f44336;
}

.video-call-button:hover {
  transform: scale(1.1);
}

/* Responsive */
@media (max-width: 480px) {
  .main-container {
    max-width: 100%;
    height: 100vh;
  }
  
  .popup {
    margin: 10px;
    padding: 20px;
  }
}
</style>
</head>

<body>
<div class="main-container">
<div class="chat-container">
  <div class="chat-header">
    <div class="back-arrow" id="backArrow" onclick="voltarPagina()">&lt;</div>
    <div class="profile-header">
      <img id="profilePhoto" src="/wp-content/uploads/2025/05/1.jpg" alt="Perfil">
      <div class="profile-info">
        <div class="profile-name" id="profileName">Luciana</div>
        <div class="profile-status" id="status">Online</div>
      </div>
    </div>
    <button onclick="handleChamadaVIP()" class="chamada-vip-chat-button">
      <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
        <path d="M23 7l-7 5 7 5V7z"/>
        <rect x="1" y="5" width="15" height="14" rx="2" ry="2"/>
      </svg>
      <span>Chamada VIP</span>
    </button>
  </div>
  
  <div class="messages" id="messages"></div>
  
  <div class="input-area">
    <input type="text" id="userInput" placeholder="Digite sua mensagem..." disabled>
    <button id="micButton" class="mic-button" onclick="handleMicClick()" title="Grava√ß√£o de voz - Exclusivo para membros">
      <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
        <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
        <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
        <path d="M12 19v4"/>
        <path d="M8 23h8"/>
      </svg>
    </button>
    <button id="sendButton" onclick="sendMessage()" disabled>
      <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
        <path d="M2 21l21-9L2 3v7l15 2-15 2v7z"/>
      </svg>
    </button>
  </div>
</div>
</div>

<script>
let canSendMessage = false;
let messagesAllowedInCurrentPhase = 0;
let messagesSentInCurrentPhase = 0;
let totalUserMessagesSent = 0;
let presenteMostrado = false;
let audioSent = false;
let currentAudioIndex = 0;

const profileImages = [
  '/wp-content/uploads/2025/05/1.jpg',
  '/wp-content/uploads/2025/05/2.jpg',
  '/wp-content/uploads/2025/05/3.jpg',
  '/wp-content/uploads/2025/05/4.jpg',
  '/wp-content/uploads/2025/05/5.jpg'
];

const audioMessages = [
  { text: "Oi amor! Como voc√™ est√°? üòò", audio: "/assets/audios/audio1.mp4" },
  { text: "Estava pensando em voc√™... üíï", audio: "/assets/audios/audio2.mp4" },
  { text: "Que tal conversarmos mais? üòç", audio: "/assets/audios/audio3.mp4" }
];

const botResponses = [
  "Que bom te ver aqui! üòä",
  "Adorei sua mensagem! üíï",
  "Voc√™ √© muito especial... üòò",
  "Estou ansiosa para te conhecer melhor! üòç",
  "Que tal uma conversa mais √≠ntima? üî•"
];

function getProfileImage() {
  const foto = localStorage.getItem('chatPerfilFoto');
  if (foto && !foto.includes('.html') && foto !== '') {
    return foto;
  }
  return profileImages[Math.floor(Math.random() * profileImages.length)];
}

function addMessage(text, isUser = false, isAudio = false, audioSrc = null) {
  const messagesContainer = document.getElementById('messages');
  const messageDiv = document.createElement('div');
  
  messageDiv.className = `message ${isUser ? 'user' : 'bot'}${isAudio ? ' audio' : ''}`;
  
  if (isAudio && audioSrc) {
    messageDiv.innerHTML = `
      <svg class="audio-icon" viewBox="0 0 24 24">
        <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
        <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
        <path d="M12 19v4"/>
        <path d="M8 23h8"/>
      </svg>
      <span>${text}</span>
    `;
    messageDiv.onclick = () => playAudio(audioSrc);
  } else {
    messageDiv.textContent = text;
  }
  
  messagesContainer.appendChild(messageDiv);
  messagesContainer.scrollTop = messagesContainer.scrollHeight;
}

function playAudio(src) {
  const audio = new Audio(src);
  audio.play().catch(e => console.log('Erro ao reproduzir √°udio:', e));
}

function sendFirstAudio() {
  if (audioSent) return;
  
  const audioMsg = audioMessages[currentAudioIndex];
  addMessage(audioMsg.text, false, true, audioMsg.audio);
  audioSent = true;
  
  setTimeout(() => {
    addMessage("Para continuar nossa conversa, voc√™ precisa ser membro VIP! üíé", false);
    setTimeout(() => {
      abrirPopupPremium();
    }, 2000);
  }, 3000);
}

function sendMessage() {
  const input = document.getElementById('userInput');
  const message = input.value.trim();
  
  if (!message || !canSendMessage) return;
  
  addMessage(message, true);
  input.value = '';
  
  messagesSentInCurrentPhase++;
  totalUserMessagesSent++;
  
  setTimeout(() => {
    const response = botResponses[Math.floor(Math.random() * botResponses.length)];
    addMessage(response, false);
    
    if (messagesSentInCurrentPhase >= messagesAllowedInCurrentPhase) {
      canSendMessage = false;
      updateSendButtonState();
      
      setTimeout(() => {
        addMessage("Para continuar, voc√™ precisa ser membro VIP! üíé", false);
        setTimeout(abrirPopupPremium, 1500);
      }, 2000);
    }
  }, 1000 + Math.random() * 2000);
}

function updateSendButtonState() {
  const sendButton = document.getElementById('sendButton');
  const userInput = document.getElementById('userInput');
  const isPremium = localStorage.getItem('isPremium') === 'true';
  
  if (isPremium) {
    sendButton.disabled = false;
    userInput.disabled = false;
    userInput.placeholder = "Digite sua mensagem...";
  } else if (canSendMessage) {
    sendButton.disabled = false;
    userInput.disabled = false;
    userInput.placeholder = "Digite sua mensagem...";
  } else {
    sendButton.disabled = true;
    userInput.disabled = true;
    userInput.placeholder = "Seja VIP para continuar...";
  }
}

function updateMicButton() {
  const micButton = document.getElementById('micButton');
  const isPremium = localStorage.getItem('isPremium') === 'true';
  
  micButton.disabled = !isPremium;
  micButton.title = isPremium ? "Gravar √°udio" : "Grava√ß√£o de voz - Exclusivo para membros";
}

function handleMicClick() {
  const isPremium = localStorage.getItem('isPremium') === 'true';
  if (!isPremium) {
    abrirPopupPremium();
    return;
  }
  
  addMessage("üé§ √Åudio gravado com sucesso!", true);
  
  setTimeout(() => {
    const response = "Adorei seu √°udio! Sua voz √© linda! üòç";
    addMessage(response, false);
  }, 1500);
}

function abrirPopupPremium() {
  const overlay = document.createElement('div');
  overlay.className = 'popup-overlay';
  overlay.innerHTML = `
    <div class="popup">
      <h3>üî• Acesso VIP Necess√°rio</h3>
      <p>Para continuar conversando e ter acesso completo ao chat, voc√™ precisa ser membro VIP!</p>
      <div class="saldo-info">
        Saldo atual: R$ <span id="saldoValorChat">0,00</span>
      </div>
      <div class="popup-buttons">
        <button class="popup-button secondary" onclick="fecharPopup()">Fechar</button>
        <button class="popup-button primary" onclick="abrirSaque()">Ser VIP</button>
      </div>
    </div>
  `;
  
  document.body.appendChild(overlay);
  
  const saldoAtual = localStorage.getItem('chatSaldo');
  if (saldoAtual) {
    const saldoFormatado = parseFloat(saldoAtual).toFixed(2).replace('.', ',');
    document.getElementById('saldoValorChat').innerText = saldoFormatado;
  }
}

function fecharPopup() {
  const overlay = document.querySelector('.popup-overlay');
  if (overlay) {
    overlay.remove();
  }
}

function abrirSaque() {
  fecharPopup();
  window.location.href = '/saque.html';
}

function handleChamadaVIP() {
  const isPremium = localStorage.getItem('isPremium') === 'true';
  if (!isPremium) {
    abrirPopupPremium();
    return;
  }
  
  const overlay = document.createElement('div');
  overlay.className = 'video-call-overlay';
  overlay.innerHTML = `
    <div class="video-call-content">
      <img id="videoCallAvatar" class="video-call-avatar" src="${getProfileImage()}" alt="Perfil">
      <div id="videoCallName" class="video-call-name">Luciana</div>
      <div class="video-call-status">Chamando...</div>
      <div class="video-call-controls">
        <button class="video-call-button decline" onclick="endCall()">
          <svg viewBox="0 0 24 24" width="24" height="24" fill="white">
            <path d="M19 12H5m7-7l-7 7 7 7"/>
          </svg>
        </button>
        <button class="video-call-button accept" onclick="acceptCall()">
          <svg viewBox="0 0 24 24" width="24" height="24" fill="white">
            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
          </svg>
        </button>
      </div>
    </div>
  `;
  
  document.body.appendChild(overlay);
}

function acceptCall() {
  endCall();
  addMessage("Chamada de v√≠deo iniciada! üìπ", false);
}

function endCall() {
  const overlay = document.querySelector('.video-call-overlay');
  if (overlay) {
    overlay.remove();
  }
}

function voltarPagina() {
  window.history.back();
}

// Event listeners
document.getElementById('userInput').addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    sendMessage();
  }
});

// Initialize
window.onload = function() {
  const nome = localStorage.getItem('chatPerfilNome') || 'Luciana';
  const foto = getProfileImage();
  const saldoAtual = localStorage.getItem('chatSaldo');

  document.getElementById('profileName').innerText = nome;
  document.getElementById('profilePhoto').src = foto;

  if (saldoAtual) {
    const saldoFormatado = parseFloat(saldoAtual).toFixed(2).replace('.', ',');
    const saldoElement = document.getElementById('saldoValorChat');
    if (saldoElement) {
      saldoElement.innerText = saldoFormatado;
    }
  }

  canSendMessage = false;
  messagesAllowedInCurrentPhase = 0;
  messagesSentInCurrentPhase = 0;
  totalUserMessagesSent = 0;
  presenteMostrado = false;
  audioSent = false;

  updateSendButtonState();
  updateMicButton();

  setTimeout(() => { 
    if (!audioSent) {
      sendFirstAudio(); 
    }
  }, 3000);
};
</script>

</body>
</html>
